<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>80 лет освобождения Беларуси — Память и Победа</title>
  <meta name="description" content="Интерактивная карта освобождения Беларуси, лента времени, голоса очевидцев, архив и квизы." />

  <!-- Leaflet (карта) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    
    crossorigin=""
  ></script>

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header class="site-header" role="banner">
  <a class="skip-link" href="#main">Пропустить к содержимому</a>
  <div class="brand">
    <img src="assets/logo.svg" alt="" aria-hidden="true" />
    <h1>80 лет освобождения Беларуси</h1>
    <p class="subtitle">Память. Ответственность. Единство.</p>
  </div>
  <nav class="main-nav" aria-label="Основная навигация">
    <ul>
      <li><a href="#map">Карта</a></li>
      <li><a href="#timeline">Лента времени</a></li>
      <li><a href="#voices">Голоса памяти</a></li>
      <li><a href="#archive">Архив</a></li>
      <li><a href="#quiz">Квизы</a></li>
      <li><a href="#wall">Стена памяти</a></li>
    </ul>
  </nav>
</header>

<main id="main">
  <!-- Герой-блок -->
  <section class="hero" aria-label="Вступление">
    <div class="hero-content">
      <h2>От памяти к пониманию</h2>
      <p>Исследуйте путь к освобождению, слушайте голоса очевидцев и делитесь своей семейной историей.</p>
      <div class="cta">
        <a href="#map" class="btn primary">Исследовать карту</a>
        <a href="#voices" class="btn">Слушать голоса</a>
      </div>
    </div>
    <div class="hero-stats" aria-label="Ключевые факты">
      <div><strong>1944</strong><span>Минск освобождён 3 июля</span></div>
      <div><strong>80</strong><span>лет памяти и ответственности</span></div>
      <div><strong>100+</strong><span>событий на карте</span></div>
    </div>
  </section>

  <!-- Карта -->
  <section id="map" class="section">
    <header>
      <h2>Карта освобождения</h2>
      <p>Перемещайтесь по карте, выбирайте события и изучайте материалы.</p>
    </header>
    <div class="map-toolbar" role="region" aria-label="Фильтры карты">
      <label>Период:
        <input type="range" min="1941" max="1945" step="1" value="1944" id="yearRange" aria-label="Год" />
      </label>
      <fieldset>
        <legend>Слои</legend>
        <label><input type="checkbox" checked data-layer="fronts" /> Фронты</label>
        <label><input type="checkbox" checked data-layer="partisans" /> Партизаны</label>
        <label><input type="checkbox" checked data-layer="cities" /> Города</label>
      </fieldset>
      <input type="search" id="mapSearch" placeholder="Поиск события или места" aria-label="Поиск на карте" />
    </div>
    <div id="leafletMap" class="map" role="application" aria-label="Интерактивная карта"></div>
    <div id="mapSidebar" class="map-sidebar" aria-live="polite"></div>
  </section>

  <!-- Лента времени -->
  <section id="timeline" class="section">
    <header>
      <h2>Лента времени</h2>
      <p>Ключевые этапы освобождения и Победы.</p>
    </header>
    <div class="timeline-controls">
      <button class="btn" data-period="all">Все годы</button>
      <button class="btn" data-period="1941-1942">1941–1942</button>
      <button class="btn" data-period="1943">1943</button>
      <button class="btn" data-period="1944">1944</button>
      <button class="btn" data-period="1945">1945</button>
    </div>
    <div id="timelineGrid" class="timeline-grid" role="list"></div>
  </section>

  <!-- Голоса памяти -->
  <section id="voices" class="section">
    <header>
      <h2>Голоса памяти</h2>
      <p>Воспоминания очевидцев и фронтовиков.</p>
    </header>
    <div class="voices-list" role="list" id="voicesList"></div>
    <dialog id="voiceDialog" aria-label="Проигрыватель воспоминаний">
      <article>
        <button class="close" aria-label="Закрыть">&times;</button>
        <h3 id="voiceTitle"></h3>
        <audio id="voiceAudio" controls preload="metadata"></audio>
        <details>
          <summary>Транскрипт</summary>
          <div id="voiceTranscript"></div>
        </details>
      </article>
    </dialog>
  </section>

  <!-- Архив -->
  <section id="archive" class="section">
    <header>
      <h2>Архив</h2>
      <p>Документы, письма, фотографии и афиши.</p>
    </header>
    <div class="archive-grid" id="archiveGrid" role="list"></div>
  </section>

  <!-- Квизы -->
  <section id="quiz" class="section">
    <header>
      <h2>Квизы</h2>
      <p>Проверьте своё знание истории и откройте новые факты.</p>
    </header>
    <div class="quiz-card">
      <div id="quizQuestion" class="quiz-question" aria-live="polite"></div>
      <div id="quizAnswers" class="quiz-answers"></div>
      <button id="nextQuestion" class="btn" disabled>Дальше</button>
      <div id="quizProgress" class="quiz-progress" aria-live="polite"></div>
    </div>
  </section>

  <!-- Стена памяти -->
  <section id="wall" class="section">

  <h2>Стена памяти</h2>

  <!-- Форма -->
  <form id="wallForm" class="wall-form" novalidate>
    <input type="text" id="name" placeholder="Имя" required>
    <textarea id="text" placeholder="Текст воспоминания" required></textarea>
    <input type="url" id="photo" placeholder="Ссылка на фото (необязательно)">
    <button type="submit" class="explore-btn">Добавить</button>
  </form>

  <!-- Toast -->
  <div id="toast"></div>

  <hr>

  <!-- Список постов -->
  <div id="wallList" class="posts-grid"></div>

  <!-- Раскрытый пост -->
  <div id="expandedOverlay" class="overlay hidden">
    <div id="expandedPost" class="expanded-post"></div>
  </div>

  <script>
  const POSTS_URL = "/api/get-posts";
  const API_URL   = "/api/update-posts";
  let postsData = [];

  async function loadPosts() {
    try {
      const res = await fetch(POSTS_URL);
      postsData = await res.json();
      renderApproved();
    } catch (err) {
      console.error("Ошибка загрузки:", err);
      showToast("Ошибка загрузки данных", "error");
    }
  }

  function renderApproved() {
    const approved = postsData
      .map((p, i) => ({...p, _idx: i})) // сохраняем реальный индекс
      .filter(p => p.status === 'approved')
      .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

document.getElementById('wallList').innerHTML = approved.map(p => `
  <div class="post-card" data-index="${p._idx}">
    ${p.photo ? `<img src="${p.photo}" alt="Фото" class="post-photo-thumb">` : ''}
    <h3>${p.name}</h3>
    <p class="post-date"><strong>Добавлен:</strong> ${p.createdAt ? new Date(p.createdAt).toLocaleString() : '—'}</p>
    <div class="post-preview">${p.text.length > 150 ? p.text.slice(0,150) + "…" : p.text}</div>
    <div class="read-more">Читать полностью ⬇</div>
  </div>
`).join('');



    document.querySelectorAll('.post-card').forEach(card => {
      card.addEventListener('click', () => {
        const idx = card.getAttribute('data-index');
        expandPost(idx);
      });
    });
  }

  function expandPost(index) {
    const p = postsData[index];
    const container = document.getElementById("expandedPost");
    container.innerHTML = `
      <div class="expanded-content">
        <button class="close-btn" onclick="closeExpanded()">✖</button>
        <h2>${p.name}</h2>
        ${p.photo ? `<img src="${p.photo}" class="expanded-photo">` : ''}
        <div class="expanded-text">${p.text}</div>
        <p class="post-date"><strong>Добавлен:</strong> ${p.createdAt ? new Date(p.createdAt).toLocaleString() : '—'}</p>
      </div>
    `;
    document.getElementById("expandedOverlay").classList.remove("hidden");
  }

  function closeExpanded() {
    document.getElementById("expandedOverlay").classList.add("hidden");
  }

  // Закрытие по Esc
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeExpanded();
  });

  // Закрытие по клику вне карточки
  document.getElementById("expandedOverlay").addEventListener("click", (e) => {
    const post = document.getElementById("expandedPost");
    if (!post.contains(e.target)) {
      closeExpanded();
    }
  });

  // Обработка формы
  document.getElementById("wallForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const form = document.getElementById("wallForm");
    if (!form.reportValidity()) {
      showToast("⚠️ Пожалуйста, заполните обязательные поля", "warn");
      return;
    }

    const name = document.getElementById("name").value.trim();
    const text = document.getElementById("text").value.trim();
    const photo = document.getElementById("photo").value.trim();

    const newPost = { 
      name, text, photo, 
      status: "pending", 
      createdAt: new Date().toISOString(),
      approvedAt: null
    };
    postsData.push(newPost);

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(postsData)
      });
      if (res.ok) {
        showToast("✅ Запись отправлена на модерацию", "success");
        form.reset();
      } else {
        showToast("❌ Ошибка сохранения", "error");
      }
    } catch (err) {
      console.error("Ошибка сохранения:", err);
      showToast("❌ Ошибка соединения", "error");
    }
  });

  // Toast
  function showToast(message, type = "info") {
    const toast = document.getElementById("toast");
    toast.innerHTML = message;
    toast.className = "show";
    setTimeout(() => {
      toast.className = toast.className.replace("show", "");
    }, 3000);
  }

  loadPosts();
  </script>


  </section>
</main>

<footer class="site-footer" role="contentinfo">
  <p>Проект к 80‑летию освобождения Беларуси и Победы в Великой Отечественной войне.</p>
  <p>Партнёры: музеи, архивы, образовательные организации.</p>
</footer>

<script src="app.data.js"></script>
<script src="app.js"></script>
</body>
</html>




























