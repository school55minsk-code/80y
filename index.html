<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- Favicon -->
<link rel="shortcut icon" href="assets/ico.ico" type="image/x-icon">
<link rel="icon" href="assets/ico.ico" type="image/x-icon">

  <title>80 лет освобождения Беларуси — Память и Победа</title>
  <meta name="description" content="Интерактивная карта освобождения Беларуси, лента времени, голоса очевидцев, архив и квизы." />

  <!-- Leaflet (карта) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    
    crossorigin=""
  ></script>

  <link rel="stylesheet" href="styles.css" />


<script type="text/javascript" src="https://vk.com/js/api/openapi.js?169"></script>
<script>
  VK.init({ apiId: 54273828, onlyWidgets: true });
</script>

<style>
  /* Базовый стиль карты */
  #leafletMap {
    width: 100%;
    height: 500px;
    position: relative;
    transition: all 0.4s ease-in-out; /* плавный переход */
  }

  /* Кнопка в углу */
  .map-fullscreen-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1000;
    background: white;
    border: 1px solid #ccc;
    padding: 6px 8px;
    cursor: pointer;
    border-radius: 4px;
    font-size: 16px;
    transition: background 0.2s;
  }
  .map-fullscreen-btn:hover {
    background: #f0f0f0;
  }

  /* Полноэкранный режим */
  .fullscreen {
    position: fixed !important;
    top: 0;
    left: 0;
    width: 100% !important;
    height: 100% !important;
    z-index: 2000 !important;
  }
</style>
  
</head>
<body>
<header class="site-header" role="banner">
  <a class="skip-link" href="#main">Пропустить к содержимому</a>
  <div class="brand">
    <img src="assets/logo1.png" alt="" aria-hidden="true" />
    <h1>80 лет освобождения Беларуси</h1>
    <p class="subtitle">Память. Ответственность. Единство.</p>
  </div>
  <nav class="main-nav" aria-label="Основная навигация">
    <ul>
      <li><a href="#map">Карта</a></li>
  <!--    <li><a href="#timeline">Лента времени</a></li> -->
      <li><a href="#voices">Видеоархив</a></li>
      <li><a href="#archive">Архив</a></li>
      <li><a href="#quiz">Квизы</a></li>
      <li><a href="#wall">Стена памяти</a></li>
    </ul>
  </nav>
</header>

<!--
<section class="video-strip">
  <div class="video-container">
    <video autoplay muted loop playsinline>
      <source src="assets/video/1.mp4" type="video/mp4">
      Ваш браузер не поддерживает видео.
    </video>
    <div class="video-overlay">
<div class="video-dots"></div>
-->



  <section class="video-strip">
  <div class="video-container">
    <video id="bgVideo" autoplay muted loop playsinline>
      <source type="video/mp4">
      Ваш браузер не поддерживает видео.
    </video>
    <div class="video-overlay">
      <div class="video-dots"></div>

<script>
  // перечисляем все видео, которые реально лежат в assets/video/
  const videos = [
    "1.mp4",
    "2.mp4",
    "3.mp4"
//    "4.mp4"
  ];

  const randomVideo = videos[Math.floor(Math.random() * videos.length)];
  const videoEl = document.getElementById("bgVideo");
  videoEl.querySelector("source").src = `assets/video/${randomVideo}`;
  videoEl.load();
</script>



  
  

       <!-- Герой-блок -->
  <section class="hero" aria-label="Вступление">
    <div class="hero-content">
      <h2>От памяти к пониманию</h2>
      <p>Исследуйте путь к освобождению, слушайте голоса очевидцев и делитесь своей семейной историей.</p>
      <div class="cta">
        <a href="#map" class="btn primary">Исследовать карту</a>
        <a href="#voices" class="btn">Смотреть видео</a>
      </div>
    </div>
    <div class="hero-stats" aria-label="Ключевые факты">
      <div><strong>1944</strong><span>Минск освобождён 3 июля</span></div>
      <div><strong>80</strong><span>лет памяти и ответственности</span></div>
      <div><strong>100+</strong><span>событий на карте</span></div>
    </div>
  </section>

      
    </div>
    
  </div>
</section>




  
<main id="main">
 

  <!-- Карта -->
  <section id="map" class="section">
    <header>
      <h2>Карта освобождения</h2>
      <p>Перемещайтесь по карте, выбирайте события и изучайте материалы.</p>
    </header>
    <div class="map-toolbar" role="region" aria-label="Фильтры карты">
<div class="range-wrapper">
  <label for="yearRange">Период (1943/1944):</label>
  <div class="range-labels" id="yearLabels"></div>
  <input type="range" min="1943" max="1944" step="1" value="1944" id="yearRange" aria-label="Год" style="width:400px;"/>
</div>

      <fieldset>
        <legend>Слои</legend>
        <label><input type="checkbox" checked data-layer="fronts" /> Операции</label>
        <label><input type="checkbox" checked data-layer="partisans" /> Партизаны</label>
        <label><input type="checkbox" checked data-layer="cities" /> Города</label>
      </fieldset>
      <input type="search" id="mapSearch" placeholder="Поиск события или места" aria-label="Поиск на карте" />
    </div>
<div id="leafletMap" class="map" role="application" aria-label="Интерактивная карта">
  <button id="fullscreenBtn" class="map-fullscreen-btn">⛶</button>
  <div class="map-overlay-bar">Перемещайтесь по карте, выбирайте события и изучайте материалы</div>
</div>

    <div id="mapSidebar" class="map-sidebar" aria-live="polite"></div>
  </section>


  






  <!-- Лента времени 
  <section id="timeline" class="section">
    <header>
      <h2>Лента времени</h2>
      <p>Ключевые этапы освобождения и Победы.</p>
    </header>
    <div class="timeline-controls">
      <button class="btn" data-period="all">Все годы</button>
      <button class="btn" data-period="1941-1942">1941–1942</button>
      <button class="btn" data-period="1943">1943</button>
      <button class="btn" data-period="1944">1944</button>
      <button class="btn" data-period="1945">1945</button>
    </div>
    <div id="timelineGrid" class="timeline-grid" role="list"></div>
  </section>

-->













  
  <!-- Видеоархив -->
  <section id="voices" class="section">
    <header>
      <h2>Видеоархив</h2>
      <p>В этом разделе собраны уникальные видеоматериалы, посвящённые 80‑летию освобождения Беларуси от немецко‑фашистских захватчиков. Здесь представлены документальные хроники военных лет, записи воспоминаний ветеранов и очевидцев, современные фильмы и репортажи о памятных мероприятиях.

Видеоархив позволяет не только увидеть исторические кадры, но и почувствовать атмосферу времени, услышать живые голоса свидетелей и понять, какой ценой была завоёвана свобода. Это пространство памяти и уважения, где прошлое оживает, чтобы напоминать о значении Победы и ответственности перед будущими поколениями.</p>
    </header>
    <div class="voices-list" role="list" id="voicesList"></div>
<dialog id="voiceDialog" aria-label="Проигрыватель воспоминаний">
  <article>
    <button class="close" aria-label="Закрыть">&times;</button>
    <h3 id="voiceTitle"></h3>
    <div class="video-wrapper">
      <iframe id="voiceVideo" width="560" height="315" 
              frameborder="0" allowfullscreen></iframe>
    </div>
    <details>
      <summary>Транскрипт</summary>
      <div id="voiceTranscript"></div>
    </details>
  </article>
</dialog>

    <div class="voices-list" role="list" id="voicesList"></div>
<div class="voices-actions">
  <button id="toggleVoices" class="btn">Показать все</button>
</div>

  </section>


<!-- Архив -->
<section id="archive" class="section">
  <header>
    <h2>Архив</h2>
    <p>Документы, письма, фотографии и афиши.</p>
  </header>

<div class="archive-grid" id="archiveGrid" role="list"></div>
<button id="toggleArchiveBtn" class="archive-toggle-btn hidden">Показать все</button>


</section>








<!-- Оверлей для раскрытого архива -->
<div id="archiveOverlay" class="overlay hidden">
  <div class="overlay-content">
    <button id="closeArchiveOverlay" class="close-btn">&times;</button>
    <figure>
      <img id="overlayImage" src="" alt="">
      <figcaption id="overlayCaption"></figcaption>
    </figure>
  </div>
</div>




  

  


  <!-- Квизы -->
  <section id="quiz" class="section">
    <header>
      <h2>Квизы</h2>
      <p>Проверьте своё знание истории и откройте новые факты.</p>
    </header>
    <div class="quiz-card">
      <div id="quizQuestion" class="quiz-question" aria-live="polite"></div>
      <div id="quizAnswers" class="quiz-answers"></div>
      <button id="nextQuestion" class="btn" disabled>Дальше</button>
      <div id="quizProgress" class="quiz-progress" aria-live="polite"></div>
    </div>
  </section>






<!-- Стена памяти -->
<section id="wall" class="section">

  <h2>Стена памяти</h2>
  <p class="wall-description">
    «Стена памяти» создана для того, чтобы сохранить дорогие сердцу воспоминания.  
    Здесь вы можете поделиться историей, фотографией или важным моментом из жизни  
    своих родных и близких — участников Великой Отечественной войны.  
  </p>


  <ul class="wall-instructions">
    <li><strong>ФИО</strong> — укажите своё имя или имя человека, о котором идёт воспоминание.</li>
    <li><strong>Название</strong> — дайте короткий заголовок вашей записи.</li>
    <li><strong>Текст воспоминания</strong> — напишите саму историю.  
        Все пробелы, отступы и переносы строк сохранятся.</li>
    <li><strong>Ссылка на фото</strong> — добавьте изображение (по желанию).</li>
  </ul>
  <p class="wall-note">
    После отправки запись попадёт на модерацию, а затем появится на стене.
  </p>

  <!-- Кнопка для показа формы -->
  <button id="showFormBtn" class="explore-btn">Заполнить форму</button>

  <!-- Форма (скрыта по умолчанию) -->
  <form id="wallForm" class="wall-form hidden" novalidate>
    <input type="text" id="fullName" placeholder="ФИО" required>
    <input type="text" id="title" placeholder="Название" required>
    <textarea id="text" placeholder="Текст воспоминания" required></textarea>
    <input type="url" id="photo" placeholder="Ссылка на фото (необязательно)">
    <button type="submit" class="explore-btn">Добавить</button>
  </form>

  <!-- Toast -->
  <div id="toast"></div>

  <hr>
 <!-- Поле поиска (минимальное добавление) -->
  <input type="text" id="searchInput" class="wall-search" placeholder="🔍 Поиск поста по названию или тексту...">
  
  <!-- Список постов -->
  <div id="wallList" class="posts-grid"></div>
  <button id="togglePostsBtn" class="explore-btn hidden">Показать все</button>

  <!-- Раскрытый пост -->
  <div id="expandedOverlay" class="overlay hidden">
    <div id="expandedPost" class="expanded-post"></div>
  </div>


<script src="app.data.js"></script>
<script src="app.js"></script>
    
  <script>
  const POSTS_URL = "/api/get-posts";
  const API_URL   = "/api/update-posts";
  let postsData = [];
  let showAll = false; // состояние кнопки
  let searchQuery = ""; // добавлено: строка поиска

  async function loadPosts() {
    try {
      const res = await fetch(POSTS_URL);
      postsData = await res.json();
      renderApproved();
    } catch (err) {
      console.error("Ошибка загрузки:", err);
      showToast("Ошибка загрузки данных", "error");
    }
  }

  // Кнопка "Заполнить форму"
  const showFormBtn = document.getElementById("showFormBtn");
  const wallForm = document.getElementById("wallForm");

  showFormBtn.addEventListener("click", () => {
    showFormBtn.classList.add("hidden");   // скрываем кнопку
    wallForm.classList.remove("hidden");   // показываем форму
  });

  function renderApproved() {
    let approved = postsData
      .map((p, i) => ({...p, _idx: i}))
      .filter(p => p.status === 'approved')
      .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

    // добавлено: фильтрация по поиску по названию и тексту
    const q = searchQuery.trim().toLowerCase();
    if (q) {
      approved = approved.filter(p =>
        (p.title && p.title.toLowerCase().includes(q)) ||
        (p.text && p.text.toLowerCase().includes(q))
      );
    }

    const wallList = document.getElementById('wallList');
    const toggleBtn = document.getElementById('togglePostsBtn');

    // кнопка показывается только если нет активного поиска и постов > 8
    if (!q && approved.length > 8) {
      toggleBtn.classList.remove("hidden");
    } else {
      toggleBtn.classList.add("hidden");
    }

    const visiblePosts = (showAll || q) ? approved : approved.slice(0, 8);

    wallList.innerHTML = visiblePosts.map(p => `
      <div class="post-card fade-in" data-index="${p._idx}">
        <p class="post-date"><strong>Добавлен:</strong> ${p.createdAt ? new Date(p.createdAt).toLocaleString() : '—'}</p>
        ${p.photo ? `<img src="${p.photo}" alt="Фото" class="post-photo-thumb">` : ''}
        <h3 class="post-title">${p.title}</h3>
        <div class="post-preview">${p.text && p.text.length > 150 ? p.text.slice(0,150) + "…" : (p.text || "")}</div>
        <div class="read-more">Читать полностью ⬇</div>
      </div>
    `).join('');

    toggleBtn.textContent = showAll ? "Скрыть" : "Показать все";

    document.querySelectorAll('.post-card').forEach(card => {
      card.addEventListener('click', () => {
        const idx = card.getAttribute('data-index');
        expandPost(idx);
      });
    });
  }

  // обработчик кнопки "Показать все / Скрыть"
  document.getElementById('togglePostsBtn').addEventListener('click', () => {
    showAll = !showAll;
    renderApproved();
  });

  // добавлено: обработчик поиска
  document.getElementById('searchInput').addEventListener('input', (e) => {
    searchQuery = e.target.value;
    showAll = false; // при активном поиске всегда показываем только результаты
    renderApproved();
  });

  function expandPost(index) {
    const p = postsData[index];
    const container = document.getElementById("expandedPost");
    container.innerHTML = `
      <div class="expanded-content">
        <button class="close-btn" onclick="closeExpanded()">✖</button>
        <p class="post-date"><strong>Добавлен:</strong> ${p.createdAt ? new Date(p.createdAt).toLocaleString() : '—'}</p>
        <p class="post-author"><strong>Добавил:</strong> ${p.fullName || "—"}</p>
        <h2 class="post-title">${p.title}</h2>
        ${p.photo ? `<img src="${p.photo}" class="expanded-photo">` : ''}
        <div class="expanded-text">${p.text || ""}</div>
        <div id="vk_comments"></div>
      </div>
    `;
    document.getElementById("expandedOverlay").classList.remove("hidden");
      // Инициализация комментариев ВК
  // Используй p.id (который теперь есть в базе) как уникальный ключ
  VK.Widgets.Comments("vk_comments", { limit: 10, attach: "*", dark: 1}, p.id);
  }

  function closeExpanded() {
    document.getElementById("expandedOverlay").classList.add("hidden");
  }

  // Закрытие по Esc
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeExpanded();
  });

  // Закрытие по клику вне карточки
  document.getElementById("expandedOverlay").addEventListener("click", (e) => {
    const post = document.getElementById("expandedPost");
    if (!post.contains(e.target)) {
      closeExpanded();
    }
  });

  // Обработка формы
  document.getElementById("wallForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const form = document.getElementById("wallForm");

    if (!form.reportValidity()) {
      showToast("⚠️ Пожалуйста, заполните обязательные поля", "warn");
      return;
    }

    const fullName = document.getElementById("fullName").value.trim();
    const title = document.getElementById("title").value.trim();
    const text = document.getElementById("text").value.trim();
    const photo = document.getElementById("photo").value.trim();

    const newPost = { 
      fullName,
      title,
      text,
      photo,
      status: "pending",
      createdAt: new Date().toISOString(),
      approvedAt: null
    };
    postsData.push(newPost);

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(postsData)
      });
      if (res.ok) {
        showToast("✅ Запись отправлена на модерацию", "success");
        form.reset();
      } else {
        showToast("❌ Ошибка сохранения", "error");
      }
    } catch (err) {
      console.error("Ошибка сохранения:", err);
      showToast("❌ Ошибка соединения", "error");
    }
  });

  // Toast (как в твоём коде)
  function showToast(message, type = "info") {
    const toast = document.getElementById("toast");
    toast.innerHTML = message;
    toast.className = "show";
    setTimeout(() => {
      toast.className = toast.className.replace("show", "");
    }, 3000);
  }

  loadPosts();
  </script>

</section>

<style>
/* Анимация плавного появления */
.post-card.fade-in {
  opacity: 0;
  transform: translateY(10px);
  animation: fadeInUp 0.4s ease forwards;
}
@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* необязательные базовые стили для поля поиска 
.wall-search {
  width: 100%;
  max-width: 640px;
  padding: 10px 12px;
  border: 1px solid #ddd;
  border-radius: 8px;
  margin: 8px 0 16px;
  font-size: 16px;
}
  */
.wall-search {
  background-color: #2c2c2c;
  border: 2px solid orange;
  color: orange;
  border-radius: 8px;
  padding: 8px 12px;
  width: 100%;
  box-sizing: border-box;
  margin-bottom: 10px;
  }
</style>









  


  


  
</main>
<div class="footer-bg"></div>
<footer class="site-footer" role="contentinfo">
  <p>Проект к конкурсу «ПАТРИОТ.by». Тема: «80 страниц истории Великой Победы»</p>
  <p>Государственное учреждение образования «Средняя школа № 55 г. Минска» © 2025</p>
</footer>








  
</body>
</html>





























































































