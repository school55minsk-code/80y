<h1>–ú–æ–¥–µ—Ä–∞—Ü–∏—è ¬´–°—Ç–µ–Ω—ã –ø–∞–º—è—Ç–∏¬ª</h1>
<div id="pending"></div>
<button id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>

<script>
const POSTS_URL = "/api/get-posts";
const API_URL   = "/api/update-posts";
let postsData = [];

async function loadPosts() {
  const res = await fetch(POSTS_URL);
  postsData = await res.json();
  renderPending();
}

function renderPending() {
  const pending = postsData.filter(p => p.status === "pending");
  document.getElementById("pending").innerHTML = pending.length
    ? pending.map((p, idx) => `
      <div class="post-card">
        <img src="${p.photo}" alt="">
        <h3>${p.name}</h3>
        <p>${p.text}</p>
        <button onclick="approve(${idx})">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        <button onclick="removePost(${idx})">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
      </div>
    `).join("")
    : "<p>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é</p>";
}

function approve(index) {
  const pending = postsData.filter(p => p.status === "pending");
  pending[index].status = "approved";
  postsData = [...postsData.filter(p => p.status !== "pending"), ...pending];
  renderPending();
}

function removePost(index) {
  const pending = postsData.filter(p => p.status === "pending");
  pending.splice(index, 1);
  postsData = [...postsData.filter(p => p.status !== "pending"), ...pending];
  renderPending();
}

document.getElementById("saveBtn").addEventListener("click", async () => {
  const res = await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(postsData)
  });
  if (res.ok) {
    alert("–û–±–Ω–æ–≤–ª–µ–Ω–æ!");
    loadPosts();
  } else {
    alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è");
  }
});

loadPosts();
</script>
<link rel="stylesheet" href="style.css">
