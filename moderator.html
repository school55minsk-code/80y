<h1>–ú–æ–¥–µ—Ä–∞—Ü–∏—è ¬´–°—Ç–µ–Ω—ã –ø–∞–º—è—Ç–∏¬ª</h1>
<div id="pending"></div>
<button id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Cloudinary</button>

<script>
const POSTS_URL = "https://res.cloudinary.com/–¢–í–û–ô_CLOUD_NAME/raw/upload/posts.json";
const API_URL = "https://–¢–í–û–ô_VERCEL_PROJECT.vercel.app/api/update-posts"; // –∞–¥—Ä–µ—Å serverless-—Ñ—É–Ω–∫—Ü–∏–∏
let postsData = [];

async function loadPosts() {
  const res = await fetch(POSTS_URL + "?v=" + Date.now());
  postsData = await res.json();
  renderPending();
}

function renderPending() {
  const pending = postsData.filter(p => p.status === "pending");
  document.getElementById("pending").innerHTML = pending.length
    ? pending.map((p, idx) => `
      <div style="border:1px solid #555;padding:10px;margin:5px;">
        <img src="${p.photo}" style="max-width:150px;"><br>
        <strong>${p.name}</strong><br>
        ${p.text}<br>
        <button onclick="approve(${idx})">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        <button onclick="removePost(${idx})">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
      </div>
    `).join("")
    : "<p>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é</p>";
}

function approve(index) {
  const pending = postsData.filter(p => p.status === "pending");
  pending[index].status = "approved";
  postsData = [...postsData.filter(p => p.status !== "pending"), ...pending];
  renderPending();
}

function removePost(index) {
  const pending = postsData.filter(p => p.status === "pending");
  pending.splice(index, 1);
  postsData = [...postsData.filter(p => p.status !== "pending"), ...pending];
  renderPending();
}

document.getElementById("saveBtn").addEventListener("click", async () => {
  const res = await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(postsData)
  });
  if (res.ok) {
    alert("–û–±–Ω–æ–≤–ª–µ–Ω–æ –≤ Cloudinary!");
    loadPosts();
  } else {
    alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è");
  }
});

loadPosts();
</script>
